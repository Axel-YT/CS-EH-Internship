"""
=========================================================
WEB APPLICATION VULNERABILITY SCANNER
=========================================================

This program scans a given website for basic security issues such as:
1. SQL Injection vulnerability
2. Cross-Site Scripting (XSS)

Purpose:
- Educational use
- Internship / Academic project
- Basic security understanding

WARNING:
Use this tool ONLY on websites you own or have permission to test.
Unauthorized scanning is illegal.
"""

# Importing required libraries
import requests                     # Used to send HTTP requests
from bs4 import BeautifulSoup       # Used to parse HTML content
from urllib.parse import urljoin    # Used to combine base URL with form action


# -------------------------------------------------------
# FUNCTION: Check SQL Injection vulnerability
# -------------------------------------------------------
def check_sql_injection(url):
    """
    This function checks whether a website is vulnerable to SQL Injection.

    It sends malicious SQL payloads in the URL and looks for
    database error messages in the response.
    """

    print("\n[+] Checking for SQL Injection vulnerability...")

    # Common SQL injection payloads
    sql_payloads = [
        "' OR '1'='1",
        "' OR 1=1--",
        "\" OR \"1\"=\"1",
        "' OR 'a'='a"
    ]

    # Common database error messages
    error_signatures = [
        "sql syntax",
        "mysql",
        "syntax error",
        "warning",
        "odbc",
        "sqlite"
    ]

    vulnerable = False  # Flag to track vulnerability

    for payload in sql_payloads:
        try:
            # Send malicious payload in URL
            test_url = url + payload
            response = requests.get(test_url, timeout=5)

            # Convert response to lowercase for easy matching
            page_content = response.text.lower()

            # Check for SQL error messages
            for error in error_signatures:
                if error in page_content:
                    print(f"[!] SQL Injection possible with payload: {payload}")
                    vulnerable = True
                    break

        except requests.exceptions.RequestException:
            print("[-] Network error while testing SQL injection.")
            return

    if not vulnerable:
        print("[✓] No SQL Injection vulnerability detected.")


# -------------------------------------------------------
# FUNCTION: Check Cross-Site Scripting (XSS)
# -------------------------------------------------------
def check_xss(url):
    """
    This function checks for reflected XSS vulnerability.

    It looks for HTML forms and injects a JavaScript payload
    to see if it appears back in the response.
    """

    print("\n[+] Checking for Cross-Site Scripting (XSS)...")

    # XSS test payload
    xss_payload = "<script>alert('XSS')</script>"

    try:
        # Fetch webpage source
        response = requests.get(url)
        soup = BeautifulSoup(response.text, "html.parser")

        # Find all forms in the webpage
        forms = soup.find_all("form")

        if not forms:
            print("[-] No forms found on this page.")
            return

        # Loop through each form
        for form in forms:
            action = form.get("action")  # where form submits data
            method = form.get("method", "get").lower()

            # Build full URL for form submission
            target_url = urljoin(url, action)

            # Prepare data dictionary
            form_data = {}

            # Get all input fields
            inputs = form.find_all("input")
            for input_tag in inputs:
                name = input_tag.get("name")
                if name:
                    form_data[name] = xss_payload

            # Send request based on method
            if method == "post":
                response = requests.post(target_url, data=form_data)
            else:
                response = requests.get(target_url, params=form_data)

            # Check if injected script is reflected
            if xss_payload in response.text:
                print("[!] XSS vulnerability detected!")
                return

        print("[✓] No XSS vulnerability detected.")

    except requests.exceptions.RequestException:
        print("[-] Error occurred while testing XSS.")


# -------------------------------------------------------
# MAIN FUNCTION
# -------------------------------------------------------
def main():
    """
    Main execution function.
    Handles user input and calls vulnerability checks.
    """

    print("===========================================")
    print("   WEB APPLICATION VULNERABILITY SCANNER   ")
    print("===========================================\n")

    # Take target URL from user
    url = input("Enter target URL (example: http://testphp.vulnweb.com): ").strip()

    # Validate URL format
    if not url.startswith("http"):
        print("❌ Invalid URL. Please include http:// or https://")
        return

    print("\nStarting vulnerability scan...\n")

    # Run vulnerability tests
    check_sql_injection(url)
    check_xss(url)

    print("\nScan completed successfully.")
    print("Use this tool only for educational and authorized purposes.")


# -------------------------------------------------------
# Program Entry Point
# -------------------------------------------------------
if __name__ == "__main__":
    main()
